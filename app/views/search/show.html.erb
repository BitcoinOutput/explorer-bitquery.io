<% chain = BLOCKCHAINS.detect{|chain| chain[:network] == @network} if @network && !@network.empty? %>
<%= render partial: 'shared/title',
           locals: {header: (chain ? t('headers.search_in',network: chain[:name], query: @query) : t('headers.search', query: @query))} %>
<script>
    var query = new widgets.query(`
    query(<%= "$network: Network!, " if @network %>$query: String!){
      search(<%= "network: $network, " if @network %>string: $query){
          subject{
            __typename
            ... on Address {
              address
              annotation
            }
            ... on Currency {
              symbol
              name
            }
          }
          network{
            network
            protocol
          }
        }
      }
    `, {
        types: [
            {
                kind: 'UNION',
                name: 'SearchResultItem',
                possibleTypes: [
                    { name: 'Address' },
                    { name: 'Currency' }
                ],
            },
        ],
    });
</script>
<div class="row">
  <div class="col mb-4">
    <div id="search"><%= t('loading') %></div>
  </div>
</div>
<script>
    var sch = new widgets.list('#search', query, 'search', {
        excludeButtons: ['csv', 'js'],
        renderData: function(data){
            if(Array.isArray(data) && data.length == 1){
                location.href = '<%= params[:locale] %>/'+data[0].network.network+'/address/'+data[0].subject.address;
            }
          return data;
        },
        title: 'Search',
        dataOptions:{
            type: 'string',
            renderCallback: function(item){
                let chains = {<%= BLOCKCHAINS.collect{|chain| "#{chain[:network]}: {name: \"#{chain[:name]}\", icon: \"#{image_pack_path "media/icon/#{chain[:icon]}"}\"}".html_safe}.join(",\n").html_safe %>};
                let url = '<%= params[:locale] %>/'+item.network.network+'/address/'+item.subject.address;
                let html = "<div class='media'>\n" +
                    "  <img src='"+chains[item.network.network].icon+"' class='mr-3' alt='"+chains[item.network.network].name+"'>\n" +
                    "  <div class='media-body word-wrap' style='min-width: 40%;'>\n" +
                    "    <h6 class='mt-0'><a href='"+url+"'>"+chains[item.network.network].name+" <%= t('address') %> "+item.subject.address+"</a></h6>\n" +
                    ((typeof item.subject.annotation) == String ? "<p>"+item.subject.annotation+"</p>\n" : "") +
                    "    <a href='"+url+"'>"+url+"</a>" +
                    "  </div>\n" +
                    "</div>";
                return html;
                return item.subject.address
            }
        }
    });
    query.request({<%= "network: '#{@network[:network]}', ".html_safe if @network %>query: '<%= @query %>'});
</script>