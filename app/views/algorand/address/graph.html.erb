<div class="row">
  <div class="col-12 col-lg-12 mb-4">
    <div class="card">
      <div class="card-header"><%= t('tabs.address.graph.name') %></div>
      <div class="card-body" style="padding: 0">
        <div id="graph"></div>
      </div>
    </div>
  </div>
  <div class="col-12 col-lg-12 mb-4">
    <div class="card">
      <div class="card-header">Money flow</div>
      <div class="card-body" style="padding: 0">
        <div id="sankey-graph" ></div>
      </div>
    </div>
  </div>
<script>
    $(document).ready(function() {
        const query = new graphs.query(`
query (  $address: String!,
        $limit: Int!,
        $currency: Int!,
        $from: ISO8601DateTime,
        $till: ISO8601DateTime){
algorand{
  inbound: coinpath(options:{desc: "amount", limit: $limit},
    date: {since: $from till: $till },
    receiver:{is: $address}
    currency:{is: $currency}
  ) {

    sender {
      address
      annotation
    }
    receiver {
      address
      annotation
    }

    amount
    transfers: count
  }


  outbound: coinpath(options:{desc: "amount", limit: $limit},
    date: {since: $from till: $till },
    sender:{is: $address}
    currency:{is: $currency}
  ) {

    sender {
      address
      annotation
    }
    receiver {
      address
      annotation
    }

    amount
    transfers: count
  }


}
}`)

        new graphs.address_graph('#graph', query, {
            title: '<%= t('tabs.address.graph.name') %>',
            theme: '<%= @theme %>',
            currencies: [<%= @currencies.collect{|cur| "{token_id:#{cur.token_id},symbol:\"#{cur.symbol}\",name:\"#{cur.name}\",search:#{cur.token_id}}"}.join(',').html_safe %>],
        })

        new graphs.address_sankey('#sankey-graph', query, {
            theme: '<%= @theme %>',
            currencies: [<%= @currencies.collect{|cur| "{token_id:#{cur.token_id},symbol:\"#{cur.symbol}\",name:\"#{cur.name}\",search:#{cur.token_id}}"}.join(',').html_safe %>],
            dependent: true
        })

        queryWithTimeRange(rr, query, <%= @from.html_safe %>, <%= @till.html_safe %>, {"limit": 10, "offset": 0, "network": "<%= params['network']['network'] %>", "address": "<%= @address %>", "currency": <%= @currencies.first && @currencies.first.token_id || 0 %>})
    })
</script>
</div>
